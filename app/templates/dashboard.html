{% extends "base.html" %}

{% block title %}Dashboard - Aerodrome Warning System{% endblock %}

{% block content %}
<div id="dashboard-app">
    <div class="dashboard-header">
        <h2 id="user-role-display">Loading...</h2>
        <div id="admin-controls" style="display: none;">
            <button onclick="toggleAudio()" id="audio-btn">Enable Audio</button>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Left Column: Alert Creation (Regional) or Chat List (Admin) -->
        <div class="left-panel">
            <div id="create-alert-section" style="display: none;" class="card">
                <h3>Create Aerodrome Warning</h3>
                <form id="alertForm" onsubmit="submitAlert(event)">
                    <!-- Common Fields -->
                    <div class="form-row" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label>Airport Code</label>
                            <input type="text" name="airport_code" value="VASD" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Sequence #</label>
                            <input type="number" name="seq_num" value="1" min="1" required>
                        </div>
                    </div>

                    <div class="form-row" style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label>Valid From (UTC)</label>
                            <input type="text" name="valid_from" placeholder="HHMM" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Valid To (UTC)</label>
                            <input type="text" name="valid_to" placeholder="HHMM" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="alertType">Type</label>
                        <select id="alertType" name="type" onchange="toggleAlertFields()" required>
                            <option value="Wind">Wind</option>
                            <option value="Thunderstorm">Thunderstorm</option>
                        </select>
                    </div>

                    <!-- Wind Fields -->
                    <div id="wind-fields">
                        <div class="form-group">
                            <label>Wind Speed (KT)</label>
                            <input type="number" name="wind_speed" placeholder="e.g. 17">
                        </div>
                        <div class="form-group">
                            <label>Max Gust (KT)</label>
                            <input type="number" name="max_gust" placeholder="e.g. 27">
                        </div>
                        <div class="form-group">
                            <label>Wind Direction (Degrees)</label>
                            <input type="number" name="wind_dir" placeholder="e.g. 020">
                        </div>
                        <!-- Added for format matching -->
                        <div class="form-group">
                            <label>Forecast Type</label>
                            <select name="wind_type">
                                <option value="OBS">OBS</option>
                                <option value="FCST">FCST</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Change</label>
                            <select name="wind_change">
                                <option value="NC">NC</option>
                                <option value="WKN">WKN</option>
                                <option value="INTF">INTF</option>
                            </select>
                        </div>
                    </div>

                    <!-- Thunderstorm Fields -->
                    <div id="ts-fields" style="display: none;">
                        <div class="form-group">
                            <label>Forecast Type</label>
                            <select name="ts_type">
                                <option value="OBS">OBS</option>
                                <option value="FCST">FCST</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Intensity</label>
                            <select name="ts_intensity">
                                <option value="FBL">FBL</option>
                                <option value="MOD">MOD</option>
                                <option value="HVY">HVY</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Change</label>
                            <select name="ts_change">
                                <option value="NC">NC</option>
                                <option value="WKN">WKN</option>
                                <option value="NTSF">NTSF</option>
                            </select>
                        </div>
                    </div>

                    <!-- Live Preview -->
                    <div class="form-group">
                        <label>Message Preview (Editable):</label>
                        <textarea id="alert-preview" class="alert-preview" name="generated_text" rows="3"></textarea>
                    </div>

                    <button type="submit">Send Alert</button>
                </form>
            </div>

            <!-- Chat Section -->
            <div class="card" style="margin-top: 2rem;">
                <h3>Communication</h3>
                <div id="chat-partner-select" style="display: none;">
                    <label>Select Airport:</label>
                    <select id="chat-partner" onchange="loadChat(this.value)">
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div id="chat-box" class="chat-box">
                    <!-- Messages go here -->
                </div>
                <form onsubmit="sendChat(event)" class="chat-input">
                    <input type="text" id="chat-message" placeholder="Type a message..." required>
                    <button type="submit">Send</button>
                </form>
            </div>
        </div>

        <!-- Right Column: Active Alerts & History -->
        <div class="right-panel">
            <div class="card">
                <h3>Active Alerts</h3>
                <div id="active-alerts-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div id="history-section" style="display: none;" class="card" style="margin-top: 2rem;">
                <h3>Past 24 Hours History</h3>
                <div id="history-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/static/dashboard.js"></script>
{% endblock %}